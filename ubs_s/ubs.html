<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="style.css">
        <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
</head>
<link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />
    <title>Ubs's</title>
</head>

<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/68da791d311aad1952561541/1j6ami6qq';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->

<body>

                <div class="row">
  <div class="container-fluid d-flex align-items-center justify-content-between">
    <!-- Logo -->
    <img src="img/suspiraorigi.png" alt width="100" height="100">  

    <h1 class="title-principal text-dark text-center flex-grow-1">
      UBS's
    </h1>

    <div class="dropdown d-flex">
      <a class="btn" href="#" role="button">
        <img src="img/conta.png" width="32" height="32">
      </a>
      <button class="btn btn-back" type="button">
        <img src="img/setaback.png" width="32" height="32">
      </button>
    </div>
  </div>
</div>

        <div class="container">
        <!--Campo CEP-->
        <form id="cepForm">
    <div class="form">
    <form 
    <label for="exampleInputCep">CEP</label>
    <input type="text" class="form" id="exampleInputCep" placeholder="XXXXX-XXX">
    <img class="addMarker" src="./img/icons/marker.svg">

    </div>
        </form>


    <!--Fim campo CEP-->

    <div>
        <div class="input-group">
            <input type="text" id="searchInput" class="form-control" placeholder="Digite o CEP acima, para que o endereço seja mostrado aqui...">
        </div>
    </div>
        <div id="enderecoResultado" class="mt-3 fs-5 text-primary"></div>
    <div id="map" style="width: 100%; height: 500px"></div>


<script>

        // Inicia o mapa
        const map = new maplibregl.Map({
            style: 'https://tiles.openfreemap.org/styles/liberty',
            center: [-46.6333, -23.5505],  // São Paulo, coordenadas iniciais
            zoom: 9.5,
            container: 'map',
        });

        // Função para buscar o endereço pelo CEP
        document.getElementById("cepForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const cep = document.getElementById("exampleInputCep").value.replace(/\D/g, '');

            // Verifica se o CEP é válido
            if (!cep || cep.length !== 8) {
                alert("Por favor, insira um CEP válido.");
                return;
            }

            // Chama a API ViaCEP para obter o endereço
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (data.erro) {
                        alert("CEP não encontrado.");
                        return;
                    }
                    const { logradouro, localidade, uf } = data;
                    document.getElementById("searchInput").value = `${logradouro}, ${localidade} - ${uf}`;

                    // Chama a função para geocodificar o endereço
                    geocodeAddress(logradouro, localidade, uf);
                });
        });



            // Função para geocodificar o endereço usando Nominatim (OpenStreetMap)
            let marcadorCepAtual = null; // Variável global para armazenar o marcador do CEP
    function geocodeAddress(logradouro, localidade, uf) {
    const address = `${logradouro}, ${localidade}, ${uf}`;
    const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(address)}&format=json&limit=1`;
    
    // Exibe os elementos ocultos
document.querySelector(".title-horarios").classList.remove("hidden");
document.querySelector(".subtitle-horarios").classList.remove("hidden");
document.querySelector(".campo").classList.remove("hidden");

    fetch(url, {
    })
        .then(response => response.json())
        .then(data => {
            if (data.length > 0) {
                const lat = parseFloat(data[0].lat);
                const lng = parseFloat(data[0].lon);

                // Centraliza o mapa nas coordenadas
                map.setCenter([lng, lat]);
                map.setZoom(13); // Dá um zoom para melhor visualização
                

                // Remove o marcador anterior, se existir
                if (marcadorCepAtual) {
                    marcadorCepAtual.remove();
                }

                // Cria e armazena o novo marcador
                marcadorCepAtual = new maplibregl.Marker()
                    // Cria um elemento HTML para o marcador vermelho
const marcadorVermelho = document.createElement("div");
marcadorVermelho.style.backgroundColor = "red";
marcadorVermelho.style.width = "20px";
marcadorVermelho.style.height = "20px";
marcadorVermelho.style.borderRadius = "50%";
marcadorVermelho.style.border = "2px solid white";
marcadorVermelho.style.boxShadow = "0 0 5px rgba(0,0,0,0.5)";

// Cria o popup com a mensagem desejada
const enderecoCompleto = `${logradouro}, ${localidade} - ${uf}`;
const popup = new maplibregl.Popup({ offset: 25 }).setText(`Você está aqui: ${enderecoCompleto}`);


// Usa esse elemento como marcador
marcadorCepAtual = new maplibregl.Marker({ element: marcadorVermelho })
    .setLngLat([lng, lat])
    .setPopup(popup)
    .addTo(map);

                    mostrarUBSsProximas(lat, lng);
                    
            } else {
                alert("Não foi possível encontrar o local.");
            }
        })
        .catch(error => {
            console.error("Erro ao buscar localização:", error);
            alert("Erro ao buscar localização.");
        });
        
}

    </script>
</script>

<div class="title-horarios hidden">Horários de funcionamento das UBS's</div>
<div class="subtitle-horarios hidden">UBS's mais próximas de mim</div>
<!--Campo de visualizar UBS's perto-->
<!--Campo 1-->
<!--<div class="container" style="height: 240px; background-color: white; margin-top: 10px;">
  <div class="w-100 h-100">
    Retângulo que ocupa 100% da largura e altura do pai
  </div>
</div>-->
<div class="campo hidden container">
    <div class="campo-ubs container" >
        <div class="title-nome-ubs">UBS</div>
        <div class="title-localizacao-ubs">Localização</div>
        <div class="title-horario-ubs">Horário de Funcionamento:</div>
        <div class="title-telefone-ubs">Telefone:</div>
        <img class="ubs-img" src="/ubs's/img/exemplo-ubs.png">
    </div>
    <!--Fim campo 1-->

    <!--Campo 2-->
    <div class="campo-ubs container-md container-sm container-lg">
        <div class="title-nome-ubs">UBS</div>
        <div class="title-localizacao-ubs">Localização</div>
        <div class="title-horario-ubs">Horário de Funcionamento:</div>
        <div class="title-telefone-ubs">Telefone:</div>
        <img class="ubs-img" src="/ubs's/img/exemplo-ubs.png">
    </div>
    <!--Fim campo 2-->

    <!--Campo 3-->
    <div class="campo-ubs container-md container-sm container-lg">
        <div class="title-nome-ubs">UBS</div>
        <div class="title-localizacao-ubs">Localização</div>
        <div class="title-horario-ubs">Horário de Funcionamento:</div>
        <div class="title-telefone-ubs">Telefone:</div>
        <img class="ubs-img" src="/ubs's/img/exemplo-ubs.png">
    </div>
    <!--Fim campo 3-->
    </div>
    
    <!--Fim campo de visualizar UBS's perto-->

</div><!--Fim container-->
<script>
    function mostrarUBSsProximas(lat, lng) {
    const ubsExemplo = [
        {
            nome: "UBS Vila Magini",
            endereco: "R. David Boscariol, 38 - Vila Magini",
            horario: "07:00 às 21:00",
            telefone: "(11) 4547-0000",
            imagem: "img/ubs_magini.png",
            link: "https://maps.app.goo.gl/e3FriNTbS7Y2WwD68"
        },
        {
            nome: "UBS Jardim Mauá",
            endereco: "Av. Joaquim Chavasco, 71 - Jardim Mauá",
            horario: "07:00 às 17:00",
            telefone: "(11) 4547-1111",
            imagem: "img/ubs_jardimMaua.jpg",
            link: "https://maps.app.goo.gl/N4Eb8qns4Ahoeq4A8"
            
        },
        {
            nome: "UBS Itapark",
            endereco: "Av. Itapark, 4189 - Itapark",
            horario: "07:00 às 17:00",
            telefone: "(11) 4512-7748",
            imagem: "img/ubs_itapark.jpg",
            link: "https://maps.app.goo.gl/AtA1PmSJTw52EBEu7"
        }
    ];

    const campo = document.querySelector(".campo");
    campo.innerHTML = ""; // Limpa os campos anteriores

    ubsExemplo.forEach(ubs => {
        const div = document.createElement("div");
        div.className = "campo-ubs";
        div.innerHTML = `
        <a href="${ubs.link}" target="_blank" style="text-decoration: none; color: inherit;">
            <div class="title-nome-ubs">${ubs.nome}</div>
            <div class="title-localizacao-ubs">${ubs.endereco}</div>
            <div class="title-horario-ubs">Horário de Funcionamento: ${ubs.horario}</div>
            <div class="title-telefone-ubs">Telefone: ${ubs.telefone}</div>
            <img class="ubs-img" src="${ubs.imagem}">
            </a>
        `;
        campo.appendChild(div);
        
        // Geocodifica o endereço da UBS
        const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(ubs.endereco)}&format=json&limit=1`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lng = parseFloat(data[0].lon);

                    // Adiciona marcador no ponto exato
                    new maplibregl.Marker()
                        .setLngLat([lng, lat])
                        .setPopup(new maplibregl.Popup().setText(ubs.nome))
                        .addTo(map);

                } else {
                    console.warn(`Não foi possível localizar: ${ubs.nome}`);
                }
            })
            .catch(error => {
                console.error(`Erro ao localizar ${ubs.nome}:`, error);
            });
    });

    
}

</script>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.js"></script>
<script>
    $('#exampleInputCep').mask('00000-000');
</script>
</html>